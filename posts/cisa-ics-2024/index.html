<!DOCTYPE html><html domain=cramik.github.io lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=/favicon.svg rel=icon type=image/svg+xml><meta content=#f9c412 name=theme-color><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name=robots><title>CISA ICS CTF 2024</title><meta content="CISA ICS CTF 2024" property=og:title><meta content="Possibly one of the messiest CTF writeups" name=description><meta content="Possibly one of the messiest CTF writeups" property=og:description><meta content=summary_large_image name=twitter:card><meta content=@ name=twitter:site><meta content=@ name=twitter:creator><meta content=https://cramik.github.io/blog//img/remote/ZayYlG.jpg property=og:image><link href=https://cramik.github.io/blog//posts/cisa-ics-2024/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/blog/feed/feed.xml rel=alternate type=application/atom+xml title=Cramik><link href=/ rel=preconnect crossorigin=""><link href=/fonts/Inter-3.19.var.woff2 rel=preload type=font/woff2 as=font crossorigin=""><script async defer src="/js/min.js?hash=8db32dcb3a"></script><style>@font-face{font-display:optional;font-family:'Noto Sans';src:url(/fonts/notosans.woff2) format('woff2')}body,header{background-color:#111}body{font-family:'Noto Sans',sans-serif;margin:0;padding:0;display:flex;flex-direction:column;align-items:center;min-height:100vh}a,a:hover{color:#f60;text-decoration:none}a:hover,body{color:#fff}header{width:100%;max-width:100%;padding:2em 1.5em;text-align:center}header nav{position:static;width:auto;background:0 0;text-align:center;padding:1em 0;z-index:auto}header nav h1{float:none;display:inline-block;margin-bottom:.5em}header nav a{color:#f60;margin:0 1.5em;display:inline-block}header nav a:first-of-type{margin-left:1.5em}header nav a:last-of-type{margin-right:1.5em}h1,h2,header nav a:hover{color:#fff}main{max-width:90%;border-top:none;width:auto;padding:1.5em;flex-grow:1;color:#ccc}article{width:auto;max-width:100%;padding:0;margin:0 auto 2em}h1,h2{font-family:'Noto Sans',sans-serif;font-style:normal}code,pre{font-family:'Noto Mono',monospace;background-color:#222;color:#ccc;border-radius:4px}pre{padding:1em;overflow-x:auto}:not(pre)>code{padding:.2em .4em;font-size:85%}</style><header><nav><div id=nav><h1><a href=/blog/ title=Homepage>Cramik</a></h1></div><div id=reading-progress aria-hidden=true></div></nav><h1>CISA ICS CTF 2024</h1><aside>6 min read.</aside><dialog id=message></dialog></header><main><article><h2 id=extend-your-stay---1>Extend Your Stay - 1 <a href=#extend-your-stay---1 class=direct-link>#</a></h2><p>crx files are chrome extensions that are basically just zip files. We can open it up, go to background.js and we'll see some code at the bottom:<pre><code>// This will execute when the extension is first installed
chrome.runtime.onInstalled.addListener(() => {
    var val = "ZmxhZ3toeXAzcjN4dDNuZDNkfQ==";
    console.log("NO MORE RODENTS!!!!!!!!!!");
    console.log(atob(val));
});
</code></pre><p>val is a base64 encoded string that decodes to "flag{hyp3r3xt3nd3d}"<h2 id=extend-your-stay---2>Extend Your Stay - 2 <a href=#extend-your-stay---2 class=direct-link>#</a></h2><p>This part is included in the obfuscated part since it is malicious, we dont actually have to deobfuscate we can just start base64 decoding random base64 strings until we find aHR0cHM6Ly93d3cuZmVsbHN3YXJnby5jb20v == <a href=https://www.fellswargo.com/ >https://www.fellswargo.com/</a> which matches the challenge prompt<h2 id=mission%3A-inconceivable---1>Mission: Inconceivable - 1 <a href=#mission%3A-inconceivable---1 class=direct-link>#</a></h2><p><a href=https://postalpro.usps.com/ppro-tools/encoder-decoder>https://postalpro.usps.com/ppro-tools/encoder-decoder</a><br>DAFFFDDFTTFATDTDFFDTDAFADAATFATDTADTAFFDDTDTTADFDTTFDDAFAFFAFTATT<br>Chicago<h2 id=mission%3A-inconceivable---2>Mission: Inconceivable - 2 <a href=#mission%3A-inconceivable---2 class=direct-link>#</a></h2><p>"Using the information you know about the attackers, especially their culinary tastes, can you identify the BSSID (the access point's MAC address) for their hideout's WiFi network?"<br>8A:9C:67:46:08:B1<br>41.67711639,-107.9834137,Bringmetacosplease,0,20230701-00000,2023-07-01T14:00:00.000Z,2023-08-26T05:00:00.000Z,2023-08-26T05:00:00.000Z,8A:9C:67:46:08:B1,,infra,,2,0,?,?,?,False,11,,wpa2,US,WY,Carlton Road,,,<h2 id=read-askew-manuscripts---1>Read Askew Manuscripts - 1 <a href=#read-askew-manuscripts---1 class=direct-link>#</a></h2><p>volatility.exe printkey -f memdump_fewer_images_test1.raw -K Software\ACME_XRay<br>ZmxhZ3tmMzNsMW5nX3YwbEB0MWwzfQ==<br>flag{f33l1ng_v0l@t1l3}<h2 id=read-askew-manuscripts---2>Read Askew Manuscripts - 2 <a href=#read-askew-manuscripts---2 class=direct-link>#</a></h2><p>C:\Users\Cramik\Downloads\memdump.raw>volatility.exe notepad -f memdump_fewer_images_test1.raw<br>Volatility Foundation Volatility Framework 2.6<br>Process: 172<br>Text:<br>Dear friend,<p>Thank you for supporting this mission. Well, not like you really had a choice :)<p>Upload the patient's image using the link below. Do not upload any other patients. And do not get the wrong patient. I am out of patience.<p><a href="https://www.ev1lf1lestorage.info/?directory=images&user=ominousnoteperson&passB64=aWxpa2V3cml0aW5nb21pbm91c25vdGVz&login=true">https://www.ev1lf1lestorage.info/?directory=images&user=ominousnoteperson&passB64=aWxpa2V3cml0aW5nb21pbm91c25vdGVz&login=true</a><p>If necessary, you can use this flash drive to extract the image, but ONLY if the cloud storage doesn't work. And I know it works so don't pull any funny business.<p>Drop this flash drive at ///trips.pistons.huffs when you're done. If you see a man with an accordion, run.<p>See you never,<p>The Ominous Note Writer<p>P.S. If you get hungry on this mission, you're on your own. Bring a snack and just Eat It.<p>ilikewritingominousnotes<h2 id=read-askew-manuscripts---3>Read Askew Manuscripts - 3 <a href=#read-askew-manuscripts---3 class=direct-link>#</a></h2><p>C:\Users\Cramik\Downloads\memdump.raw>volatility.exe iehistory -f memdump_fewer_images_test1.raw<br>Volatility Foundation Volatility Framework 2.6<hr><p>Process: 1588 explorer.exe<br>Cache type "DEST" at 0x21b1e2d<br>Last modified: 2024-04-11 11:42:52 UTC+0000<br>Last accessed: 2024-04-11 17:42:54 UTC+0000<br>URL: Administrator@file:///E:/Phoenix_Wright.png<hr><p>Process: 1588 explorer.exe<br>Cache type "DEST" at 0x21cea1d<br>Last modified: 2024-04-11 11:42:52 UTC+0000<br>Last accessed: 2024-04-11 17:42:54 UTC+0000<br>URL: Administrator@file:///E:/Phoenix_Wright.png<h2 id=read-askew-manuscripts---4>Read Askew Manuscripts - 4 <a href=#read-askew-manuscripts---4 class=direct-link>#</a></h2><p><a href=https://steemit.com/security/@nybble/forensic-extracting-files-from-mft-table-with-volatility-part-2-en>https://steemit.com/security/@nybble/forensic-extracting-files-from-mft-table-with-volatility-part-2-en</a><p>C:\Users\Cramik\Downloads\memdump.raw>volatility.exe filescan -f memdump_fewer_images_test1.raw | grep Phoenix<br>Volatility Foundation Volatility Framework 2.6<br>0x00000000096959b0 1 0 RW-rw- \Device\HarddiskVolume1\Documents and Settings\Administrator\Recent\Phoenix_Wright.lnk<br>0x0000000009769228 1 0 R--r-- \Device\DP(1)0-0+3\Phoenix_Wright.png<br>0x000000000978c820 1 0 R--r-- \Device\HarddiskVolume1\Documents and Settings\Administrator\Desktop\patient_images\Phoenix_Wright.png<p>C:\Users\Cramik\Downloads\memdump.raw>volatility.exe dumpfiles -Q 0x0000000009769228 -D files/ -u -n -f memdump_fewer_images_test1.raw<br>Volatility Foundation Volatility Framework 2.6<br>DataSectionObject 0x09769228 None \Device\DP(1)0-0+3\Phoenix_Wright.png<h2 id=follow-the-charts---3>Follow the Charts - 3 <a href=#follow-the-charts---3 class=direct-link>#</a></h2><p>The malicious application is a notes to bash converter. The main function for decoding is "decodechart." Reversing is an option, but would be hard considering the amount of xors, bitwise operations, and subfuctions. Instead, we can use a sandbox like app.any.run just to see what commands it runs and we'll see "sh -c "#flag{W31C0Me_t0_tH3_JUn6L3} echo "Finished updating clone hero charts :)"""<h2 id=introduction-to-malcolm---8>Introduction to Malcolm - 8 <a href=#introduction-to-malcolm---8 class=direct-link>#</a></h2><p>destination.port>60000 AND source.port>60000<br>include the network.community_id field on the left side<h2 id=introduction-to-malcolm---9>Introduction to Malcolm - 9 <a href=#introduction-to-malcolm---9 class=direct-link>#</a></h2><p>communityId=="1:lkHwtdagxh1Nv9QKO2SuVdVkQ0I="<h2 id=learning-to-drift---1>Learning to DRIFT - 1 <a href=#learning-to-drift---1 class=direct-link>#</a></h2><p>packet 6 PLC -> HMI NEW-CONNECTION-RESPONSE<br>000c = length<br>01 = message code (NEW-CONNECTION)<br>00 = respone code<br>61cb506b8ff1b477 = Partial AES<p>The first encrypted command sent by the HMI in this capture is a Read-Sensor command. What was the responded current-value of that sensor (sensor id is 100)?<p>packet 8 HMI -> PLC READ-SENSOR-REQUEST<br>001a = length<br>a9de4b26a71f6989 = partial aes key<br>6d21595f8c02ffad25b55ed49a4a3d8e<p>Create a cyberchef recipe:<br>AES_Decrypt({'option':'Hex','string':'61cb506b8ff1b477a9de4b26a71f6989'},{'option':'Hex','string':''},'ECB','Hex','Raw',{'option':'Hex','string':''},{'option':'Hex','string':''})<br>To_Hex('Space',0)<p>Decrypt 6d21595f8c02ffad25b55ed49a4a3d8e<p>Output:<br>03 - Message code (READ-SENSOR)<br>64 - Sensor ID<p>Packet 9 PLC -> HMI READ-SENSOR-RESPONSE<br>001a = length<br>9191c45d7fe2ddca = partial aes key<br>39f35ca00eb0ada6c29996f1bf9eb2e7<p>AES_Decrypt({'option':'Hex','string':'61cb506b8ff1b4779191c45d7fe2ddca'},{'option':'Hex','string':''},'ECB','Hex','Raw',{'option':'Hex','string':''},{'option':'Hex','string':''})<br>To_Hex('Space',0)<br>Decrypt 39f35ca00eb0ada6c29996f1bf9eb2e7<p>Output:<br>03 = message code<br>00 = response code<br>64 = sensor id<br>00 00 02 06 = value<br>0206 hex to decimal is 518<p>Bulk Recipe:<br>Drop_bytes(0,4,false)<br>Register('(^.{16})',true,false,false)<br>Drop_bytes(0,16,false)<br>AES_Decrypt({'option':'Hex','string':'9bc665880b5df8fc$R0'},{'option':'Hex','string':''},'ECB','Hex','Raw',{'option':'Hex','string':''},{'option':'Hex','string':''})<br>To_Hex('Space',0)<p>Sensor request: 001a0a6f538822259c7390a6e5d86712724891d7549593f8ff95<br>06 = message code<br>06 = count<br>64 65 66 67 68 69 = sensor ids<p>Sensor Response:<br>06 = message code<br>00 = response code<br>06 = sensor count<br>Sensor ranges:<br>64 00 00 01 e0 00 00 02 3a 00 00 01 c2 00 00 02 58 65 00 00 01 9a 00 00 01 ea 00 00 01 90 00 00 01 f4 66 00 00 00 41 00 00 00 4b 00 00 00 3c 00 00 00 50 67 00 00 00 41 00 00 00 4b 00 00 00 3c 00 00 00 50 68 00 00 00 41 00 00 00 4b 00 00 00 3c 00 00 00 50 69 00 00 00 41 00 00 00 4b 00 00 00 3c 00 00 00 50<p>Each sensor range is 17 bytes:<br>64000001e00000023a000001c200000258<br>650000019a000001ea00000190000001f4<br>66000000410000004b0000003c00000050<br>67000000410000004b0000003c00000050<br>68000000410000004b0000003c00000050<br>69000000410000004b0000003c00000050<p>Break up each sensor range to ID and ranges<br>64 = Sensor ID<br>000001e0 = WARNING-LOW<br>0000023a = WARNING-HIGH<br>000001c2 = ALERT-LOW<br>00000258 = ALERT-HIGH<p>Alarms (3rd TCP session):<br>001a8ddec2027f0172a440e2a3c789beff16e77009c9c5213c1f - GET-ALARM-REQUEST (0x07)<p>001a64314cb84d00addee6843f0381d1db25da6b2506dd76f524 - GET-ALARMS-RESPONSE<p>Decrypts to:<br>07 - Message code<br>00 - Response code<br>02 - Alarm Count<br>Alarm Data:<br>66 - Sensor ID<br>a0 - Alarm Code (WARNING: LOW)<br>0000003f - Value = 63<p>6b - Sensor ID<br>b1 - Alarm Code (ALERT: HIGH)<br>0000041a - Value = 1050<h2 id=a-timely-attack>A Timely Attack <a href=#a-timely-attack class=direct-link>#</a></h2><pre><code>import subprocess
import string
import time

# Base string to start with
test_string = ["0"]*8
best_char = ''
keyspace = string.digits+string.ascii_lowercase

for i in range(len(test_string)):
	max_time = -1
	second_best = -1
	best_char = ''
	
	for char in keyspace:
		test_string[i]=char
		
		start_time = time.time()

		for _ in range(1): subprocess.run(["./time_attack1", ''.join(test_string)], stdout=subprocess.PIPE, stderr=subprocess.PIPE)

		elapsed_time = time.time() - start_time
		print(f"{char} - {elapsed_time}")
		if elapsed_time > max_time:
			second_best = max_time
			max_time = elapsed_time
			best_char = char
	test_string[i]=best_char
	print(f"Found {best_char} {(max_time/second_best-1)} Current best string: {''.join(test_string)}, elapsed time: {max_time}")

# Final string after all iterations
print(f"Final string: {test_string}")
</code></pre><p>flag{1t_0Nly_T@k3s_4_l3ttlE_T!mE}</p><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "CISA ICS CTF 2024",
  "image": [],
  "author": "Cramik", 
  "genre": "Insert a schema.org genre", 
  "publisher": {
    "@type": "Organization",
    "name": ""
  },
  "url": "https://cramik.github.io/blog//posts/cisa-ics-2024/",
  "mainEntityOfPage": "https://cramik.github.io/blog//posts/cisa-ics-2024/",
  "datePublished": "2024-09-01",
  "dateModified": "2025-05-25",
  "description": "Extend Your Stay - 1 # crx files are chrome extensions that are basically just zip files. We can open it up, go to background.js and we&#39;ll..."
}</script><p>Published <time datetime=2024-09-01>01 Sep 2024</time></article></main>